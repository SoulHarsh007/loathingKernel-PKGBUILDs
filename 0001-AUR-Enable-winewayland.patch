From aa1b2ccd48dcee5f51fe662f2a7b2ab8a151a7cc Mon Sep 17 00:00:00 2001
From: Stelios Tsampas <loathingkernel@gmail.com>
Date: Thu, 29 Feb 2024 15:28:48 +0200
Subject: [PATCH] AUR Enable winewayland

---
 Makefile.in | 1 +
 proton      | 4 ++++
 2 files changed, 5 insertions(+)

diff --git a/Makefile.in b/Makefile.in
index 99ee6e17..581b981c 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -426,6 +426,7 @@ WINE_SOURCE_ARGS = \
 
 WINE_CONFIGURE_ARGS = \
   --with-x \
+  --with-wayland \
   --with-gstreamer \
   --with-mingw \
   --without-oss \
diff --git a/proton b/proton
index 027e5650..09e4fea7 100755
--- a/proton
+++ b/proton
@@ -1525,6 +1525,10 @@ if __name__ == "__main__":
     elif sys.argv[1] == "waitforexitandrun":
         #wait for wineserver to shut down
         g_session.run_proc([g_proton.wineserver_bin, "-w"])
+        g_session.run_proc(
+            [g_proton.wine_bin, "reg.exe", "add", "HKCU\\Software\\Wine\\Drivers", "/v", "Graphics", "/d", "x11,wayland", "/f"]
+        )
+        g_session.run_proc([g_proton.wineserver_bin, "-w"])
         #then run
         rc = g_session.run()
     elif sys.argv[1] == "runinprefix":
-- 
2.44.0

